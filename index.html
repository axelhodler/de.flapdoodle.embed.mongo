<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Embedmongo.flapdoodle.de : " />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Embedmongo.flapdoodle.de</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/xorrr/de.flapdoodle.embed.mongo">View on GitHub</a>

          <h1 id="project_title">Embedmongo.flapdoodle.de</h1>
          <h2 id="project_tagline"></h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/xorrr/de.flapdoodle.embed.mongo/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/xorrr/de.flapdoodle.embed.mongo/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="organisation-flapdoodle-oss" class="anchor" href="#organisation-flapdoodle-oss"><span class="octicon octicon-link"></span></a>Organisation Flapdoodle OSS</h1>

<p><a href="https://drone.io/github.com/flapdoodle-oss/embedmongo.flapdoodle.de/latest"><img src="https://drone.io/github.com/flapdoodle-oss/embedmongo.flapdoodle.de/status.png" alt="Build Status"></a></p>

<p>adsfasdfasdfasdf
We are now a github organisation. You are invited to participate. :)</p>

<h1>
<a name="embedded-mongodb" class="anchor" href="#embedded-mongodb"><span class="octicon octicon-link"></span></a>Embedded MongoDB</h1>

<p>Embedded MongoDB will provide a platform neutral way for running mongodb in unittests.</p>

<h2>
<a name="why" class="anchor" href="#why"><span class="octicon octicon-link"></span></a>Why?</h2>

<ul>
<li>dropping databases causing some pains (often you have to wait long time after each test)</li>
<li>its easy, much easier as installing right version by hand</li>
<li>you can change version per test</li>
</ul><h2>
<a name="dependencies" class="anchor" href="#dependencies"><span class="octicon octicon-link"></span></a>Dependencies</h2>

<h3>
<a name="build-on-top-of" class="anchor" href="#build-on-top-of"><span class="octicon octicon-link"></span></a>Build on top of</h3>

<ul>
<li>Embed Process Util <a href="https://github.com/flapdoodle-oss/de.flapdoodle.embed.process">de.flapdoodle.embed.process</a>
</li>
</ul><h3>
<a name="other-ways-to-use-embedded-mongodb" class="anchor" href="#other-ways-to-use-embedded-mongodb"><span class="octicon octicon-link"></span></a>Other ways to use Embedded MongoDB</h3>

<ul>
<li>in a Maven build using <a href="https://github.com/joelittlejohn/embedmongo-maven-plugin">embedmongo-maven-plugin</a>
</li>
<li>in a Clojure/Leiningen project using <a href="https://github.com/joelittlejohn/lein-embongo">lein-embongo</a>
</li>
<li>in a Gradle build using <a href="https://github.com/sourcemuse/GradleMongoPlugin">gradle-mongo-plugin</a>
</li>
<li>in a Scala/specs2 specification using <a href="https://github.com/athieriot/specs2-embedmongo">specs2-embedmongo</a>
</li>
<li>in Scala tests using <a href="https://github.com/SimplyScala/scalatest-embedmongo">scalatest-embedmongo</a>
</li>
</ul><h3>
<a name="comments-about-embedded-mongodb-in-the-wild" class="anchor" href="#comments-about-embedded-mongodb-in-the-wild"><span class="octicon octicon-link"></span></a>Comments about Embedded MongoDB in the Wild</h3>

<ul>
<li><a href="http://stackoverflow.com/questions/6437226/embedded-mongodb-when-running-integration-tests">http://stackoverflow.com/questions/6437226/embedded-mongodb-when-running-integration-tests</a></li>
<li><a href="http://www.cubeia.com/index.php/blog/archives/436">http://www.cubeia.com/index.php/blog/archives/436</a></li>
<li><a href="http://blog.diabol.se/?p=390">http://blog.diabol.se/?p=390</a></li>
</ul><h3>
<a name="other-mongodb-stuff" class="anchor" href="#other-mongodb-stuff"><span class="octicon octicon-link"></span></a>Other MongoDB Stuff</h3>

<ul>
<li>
<a href="https://github.com/thiloplanz/jmockmongo">https://github.com/thiloplanz/jmockmongo</a> - mongodb mocking</li>
<li>
<a href="https://github.com/lordofthejars/nosql-unit">https://github.com/lordofthejars/nosql-unit</a> - extended nosql unit testing</li>
<li>
<a href="https://github.com/jirutka/embedmongo-spring">https://github.com/jirutka/embedmongo-spring</a> - Spring Factory Bean for EmbedMongo</li>
</ul><h2>
<a name="howto" class="anchor" href="#howto"><span class="octicon octicon-link"></span></a>Howto</h2>

<h3>
<a name="maven" class="anchor" href="#maven"><span class="octicon octicon-link"></span></a>Maven</h3>

<p><strong>IMPORTANT NOTE: maven groupId and artifactId change</strong></p>

<ul>
<li>  groupId from <strong>de.flapdoodle.embedmongo</strong> to <strong>de.flapdoodle.embed</strong>
</li>
<li>  artifactId from <strong>de.flapdoodle.embedmongo</strong> to <strong>de.flapdoodle.embed.mongo</strong>
</li>
</ul><p>Stable (Maven Central Repository, Released: 06.04.2014 - wait 24hrs for <a href="http://repo1.maven.org/maven2/de/flapdoodle/embed/de.flapdoodle.embed.mongo/maven-metadata.xml">maven central</a>)</p>

<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;de.flapdoodle.embed&lt;/groupId&gt;
    &lt;artifactId&gt;de.flapdoodle.embed.mongo&lt;/artifactId&gt;
    &lt;version&gt;1.43&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<p>Snapshots (Repository <a href="http://oss.sonatype.org/content/repositories/snapshots">http://oss.sonatype.org/content/repositories/snapshots</a>)</p>

<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;de.flapdoodle.embed&lt;/groupId&gt;
    &lt;artifactId&gt;de.flapdoodle.embed.mongo&lt;/artifactId&gt;
    &lt;version&gt;1.44-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<h3>
<a name="build-from-source" class="anchor" href="#build-from-source"><span class="octicon octicon-link"></span></a>Build from source</h3>

<p>When you fork or clone our branch you should always be able to build the library by running </p>

<pre><code>mvn package
</code></pre>

<p>There is also a build.gradle file available which might sometimes be outdated but we try to keep it working. So the gradle command is</p>

<pre><code>gradle build
</code></pre>

<p>Or if you want to use the gradle wrapper:</p>

<pre><code>./gradlew build
</code></pre>

<h3>
<a name="changelog" class="anchor" href="#changelog"><span class="octicon octicon-link"></span></a>Changelog</h3>

<p><a href="Changelog.md">Changelog</a></p>

<h3>
<a name="supported-versions" class="anchor" href="#supported-versions"><span class="octicon octicon-link"></span></a>Supported Versions</h3>

<p>Versions: some older, a stable and a development version
Support for Linux, Windows and MacOSX.</p>

<h3>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h3>

<div class="highlight highlight-java"><pre>    <span class="kn">import</span> <span class="nn">de.flapdoodle.embed.mongo.config.ArtifactStoreBuilder</span><span class="o">;</span>

    <span class="o">...</span>
    <span class="n">MongodStarter</span> <span class="n">runtime</span> <span class="o">=</span> <span class="n">MongodStarter</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">();</span>

    <span class="kt">int</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">12345</span><span class="o">;</span>
    <span class="n">IMongodConfig</span> <span class="n">mongodConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MongodConfigBuilder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">version</span><span class="o">(</span><span class="n">Version</span><span class="o">.</span><span class="na">Main</span><span class="o">.</span><span class="na">PRODUCTION</span><span class="o">)</span>
        <span class="o">.</span><span class="na">net</span><span class="o">(</span><span class="k">new</span> <span class="n">Net</span><span class="o">(</span><span class="n">port</span><span class="o">,</span> <span class="n">Network</span><span class="o">.</span><span class="na">localhostIsIPv6</span><span class="o">()))</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>

    <span class="n">MongodExecutable</span> <span class="n">mongodExecutable</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">mongodExecutable</span> <span class="o">=</span> <span class="n">runtime</span><span class="o">.</span><span class="na">prepare</span><span class="o">(</span><span class="n">mongodConfig</span><span class="o">);</span>
        <span class="n">MongodProcess</span> <span class="n">mongod</span> <span class="o">=</span> <span class="n">mongodExecutable</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

        <span class="n">MongoClient</span> <span class="n">mongo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MongoClient</span><span class="o">(</span><span class="s">"localhost"</span><span class="o">,</span> <span class="n">port</span><span class="o">);</span>
        <span class="n">DB</span> <span class="n">db</span> <span class="o">=</span> <span class="n">mongo</span><span class="o">.</span><span class="na">getDB</span><span class="o">(</span><span class="s">"test"</span><span class="o">);</span>
        <span class="n">DBCollection</span> <span class="n">col</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">createCollection</span><span class="o">(</span><span class="s">"testCol"</span><span class="o">,</span> <span class="k">new</span> <span class="n">BasicDBObject</span><span class="o">());</span>
        <span class="n">col</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="n">BasicDBObject</span><span class="o">(</span><span class="s">"testDoc"</span><span class="o">,</span> <span class="k">new</span> <span class="n">Date</span><span class="o">()));</span>

    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">mongodExecutable</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
            <span class="n">mongodExecutable</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
    <span class="o">}</span>
</pre></div>

<h3>
<a name="usage---optimization" class="anchor" href="#usage---optimization"><span class="octicon octicon-link"></span></a>Usage - Optimization</h3>

<p>You should make the MongodStarter instance or the RuntimeConfig instance static (per Class or per JVM).
The main purpose of that is the caching of extracted executables and library files. This is done by the ArtifactStore instance
configured with the RuntimeConfig instance. Each instance uses its own cache so multiple RuntimeConfig instances will use multiple
ArtifactStores an multiple caches with much less cache hits:)  </p>

<h3>
<a name="usage---custom-mongod-filename" class="anchor" href="#usage---custom-mongod-filename"><span class="octicon octicon-link"></span></a>Usage - custom mongod filename</h3>

<p>To avoid windows firewall dialog popups you can chose a stable executable name with UserTempNaming. 
This way the firewall dialog only popup once any your done. See <a href="#executable-collision">Executable Collision</a> </p>

<div class="highlight highlight-java"><pre>    <span class="kn">import</span> <span class="nn">de.flapdoodle.embed.mongo.config.ArtifactStoreBuilder</span><span class="o">;</span>

    <span class="o">...</span>

    <span class="kt">int</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">12345</span><span class="o">;</span>

    <span class="n">Command</span> <span class="n">command</span> <span class="o">=</span> <span class="n">Command</span><span class="o">.</span><span class="na">MongoD</span><span class="o">;</span>

    <span class="n">IRuntimeConfig</span> <span class="n">runtimeConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RuntimeConfigBuilder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">defaults</span><span class="o">(</span><span class="n">command</span><span class="o">)</span>
        <span class="o">.</span><span class="na">artifactStore</span><span class="o">(</span><span class="k">new</span> <span class="n">ArtifactStoreBuilder</span><span class="o">()</span>
            <span class="o">.</span><span class="na">defaults</span><span class="o">(</span><span class="n">command</span><span class="o">)</span>
            <span class="o">.</span><span class="na">download</span><span class="o">(</span><span class="k">new</span> <span class="n">DownloadConfigBuilder</span><span class="o">()</span>
            <span class="o">.</span><span class="na">defaultsForCommand</span><span class="o">(</span><span class="n">command</span><span class="o">))</span>
            <span class="o">.</span><span class="na">executableNaming</span><span class="o">(</span><span class="k">new</span> <span class="n">UserTempNaming</span><span class="o">()))</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>

    <span class="n">IMongodConfig</span> <span class="n">mongodConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MongodConfigBuilder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">version</span><span class="o">(</span><span class="n">Version</span><span class="o">.</span><span class="na">Main</span><span class="o">.</span><span class="na">PRODUCTION</span><span class="o">)</span>
        <span class="o">.</span><span class="na">net</span><span class="o">(</span><span class="k">new</span> <span class="n">Net</span><span class="o">(</span><span class="n">port</span><span class="o">,</span> <span class="n">Network</span><span class="o">.</span><span class="na">localhostIsIPv6</span><span class="o">()))</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>

    <span class="n">MongodStarter</span> <span class="n">runtime</span> <span class="o">=</span> <span class="n">MongodStarter</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">runtimeConfig</span><span class="o">);</span>

    <span class="n">MongodExecutable</span> <span class="n">mongodExecutable</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">mongodExecutable</span> <span class="o">=</span> <span class="n">runtime</span><span class="o">.</span><span class="na">prepare</span><span class="o">(</span><span class="n">mongodConfig</span><span class="o">);</span>
        <span class="n">MongodProcess</span> <span class="n">mongod</span> <span class="o">=</span> <span class="n">mongodExecutable</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

        <span class="n">MongoClient</span> <span class="n">mongo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MongoClient</span><span class="o">(</span><span class="s">"localhost"</span><span class="o">,</span> <span class="n">port</span><span class="o">);</span>
        <span class="n">DB</span> <span class="n">db</span> <span class="o">=</span> <span class="n">mongo</span><span class="o">.</span><span class="na">getDB</span><span class="o">(</span><span class="s">"test"</span><span class="o">);</span>
        <span class="n">DBCollection</span> <span class="n">col</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">createCollection</span><span class="o">(</span><span class="s">"testCol"</span><span class="o">,</span> <span class="k">new</span> <span class="n">BasicDBObject</span><span class="o">());</span>
        <span class="n">col</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="n">BasicDBObject</span><span class="o">(</span><span class="s">"testDoc"</span><span class="o">,</span> <span class="k">new</span> <span class="n">Date</span><span class="o">()));</span>

    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">mongodExecutable</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
            <span class="n">mongodExecutable</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
    <span class="o">}</span>
</pre></div>

<h3>
<a name="unit-tests" class="anchor" href="#unit-tests"><span class="octicon octicon-link"></span></a>Unit Tests</h3>

<div class="highlight highlight-java"><pre>    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">AbstractMongoDBTest</span> <span class="kd">extends</span> <span class="n">TestCase</span> <span class="o">{</span>

        <span class="cm">/**</span>
<span class="cm">         * please store Starter or RuntimeConfig in a static final field</span>
<span class="cm">         * if you want to use artifact store caching (or else disable caching) </span>
<span class="cm">         */</span>
        <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">MongodStarter</span> <span class="n">starter</span> <span class="o">=</span> <span class="n">MongodStarter</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">();</span>

        <span class="kd">private</span> <span class="n">MongodExecutable</span> <span class="n">_mongodExe</span><span class="o">;</span>
        <span class="kd">private</span> <span class="n">MongodProcess</span> <span class="n">_mongod</span><span class="o">;</span>

        <span class="kd">private</span> <span class="n">MongoClient</span> <span class="n">_mongo</span><span class="o">;</span>
        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

            <span class="n">_mongodExe</span> <span class="o">=</span> <span class="n">starter</span><span class="o">.</span><span class="na">prepare</span><span class="o">(</span><span class="k">new</span> <span class="n">MongodConfigBuilder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">version</span><span class="o">(</span><span class="n">Version</span><span class="o">.</span><span class="na">Main</span><span class="o">.</span><span class="na">PRODUCTION</span><span class="o">)</span>
                <span class="o">.</span><span class="na">net</span><span class="o">(</span><span class="k">new</span> <span class="n">Net</span><span class="o">(</span><span class="mi">12345</span><span class="o">,</span> <span class="n">Network</span><span class="o">.</span><span class="na">localhostIsIPv6</span><span class="o">()))</span>
                <span class="o">.</span><span class="na">build</span><span class="o">());</span>
            <span class="n">_mongod</span> <span class="o">=</span> <span class="n">_mongodExe</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

            <span class="kd">super</span><span class="o">.</span><span class="na">setUp</span><span class="o">();</span>

            <span class="n">_mongo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MongoClient</span><span class="o">(</span><span class="s">"localhost"</span><span class="o">,</span> <span class="mi">12345</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">tearDown</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">.</span><span class="na">tearDown</span><span class="o">();</span>

            <span class="n">_mongod</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
            <span class="n">_mongodExe</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="n">Mongo</span> <span class="nf">getMongo</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">_mongo</span><span class="o">;</span>
        <span class="o">}</span>

    <span class="o">}</span>
</pre></div>

<h4>
<a name="-with-some-more-help" class="anchor" href="#-with-some-more-help"><span class="octicon octicon-link"></span></a>... with some more help</h4>

<div class="highlight highlight-java"><pre>    <span class="o">...</span>
    <span class="n">MongodForTestsFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">factory</span> <span class="o">=</span> <span class="n">MongodForTestsFactory</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">Version</span><span class="o">.</span><span class="na">Main</span><span class="o">.</span><span class="na">PRODUCTION</span><span class="o">);</span>

        <span class="n">MongoClient</span> <span class="n">mongo</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">newMongo</span><span class="o">();</span>
        <span class="n">DB</span> <span class="n">db</span> <span class="o">=</span> <span class="n">mongo</span><span class="o">.</span><span class="na">getDB</span><span class="o">(</span><span class="s">"test-"</span> <span class="o">+</span> <span class="n">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">());</span>
        <span class="n">DBCollection</span> <span class="n">col</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">createCollection</span><span class="o">(</span><span class="s">"testCol"</span><span class="o">,</span> <span class="k">new</span> <span class="n">BasicDBObject</span><span class="o">());</span>
        <span class="n">col</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="n">BasicDBObject</span><span class="o">(</span><span class="s">"testDoc"</span><span class="o">,</span> <span class="k">new</span> <span class="n">Date</span><span class="o">()));</span>

    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">factory</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
            <span class="n">factory</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="o">...</span>
</pre></div>

<h3>
<a name="customize-download-url" class="anchor" href="#customize-download-url"><span class="octicon octicon-link"></span></a>Customize Download URL</h3>

<div class="highlight highlight-java"><pre>    <span class="o">...</span>
    <span class="n">Command</span> <span class="n">command</span> <span class="o">=</span> <span class="n">Command</span><span class="o">.</span><span class="na">MongoD</span><span class="o">;</span>

    <span class="n">IRuntimeConfig</span> <span class="n">runtimeConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RuntimeConfigBuilder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">defaults</span><span class="o">(</span><span class="n">command</span><span class="o">)</span>
        <span class="o">.</span><span class="na">artifactStore</span><span class="o">(</span><span class="k">new</span> <span class="n">ArtifactStoreBuilder</span><span class="o">()</span>
            <span class="o">.</span><span class="na">defaults</span><span class="o">(</span><span class="n">command</span><span class="o">)</span>
            <span class="o">.</span><span class="na">download</span><span class="o">(</span><span class="k">new</span> <span class="n">DownloadConfigBuilder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">defaultsForCommand</span><span class="o">(</span><span class="n">command</span><span class="o">)</span>
                <span class="o">.</span><span class="na">downloadPath</span><span class="o">(</span><span class="s">"http://my.custom.download.domain/"</span><span class="o">)))</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">...</span>
</pre></div>

<h3>
<a name="customize-artifact-storage" class="anchor" href="#customize-artifact-storage"><span class="octicon octicon-link"></span></a>Customize Artifact Storage</h3>

<div class="highlight highlight-java"><pre>    <span class="o">...</span>
    <span class="n">IDirectory</span> <span class="n">artifactStorePath</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FixedPath</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"user.home"</span><span class="o">)</span> <span class="o">+</span> <span class="s">"/.embeddedMongodbCustomPath"</span><span class="o">);</span>
    <span class="n">ITempNaming</span> <span class="n">executableNaming</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UUIDTempNaming</span><span class="o">();</span>

    <span class="n">Command</span> <span class="n">command</span> <span class="o">=</span> <span class="n">Command</span><span class="o">.</span><span class="na">MongoD</span><span class="o">;</span>

    <span class="n">IRuntimeConfig</span> <span class="n">runtimeConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RuntimeConfigBuilder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">defaults</span><span class="o">(</span><span class="n">command</span><span class="o">)</span>
        <span class="o">.</span><span class="na">artifactStore</span><span class="o">(</span><span class="k">new</span> <span class="n">ArtifactStoreBuilder</span><span class="o">()</span>
            <span class="o">.</span><span class="na">defaults</span><span class="o">(</span><span class="n">command</span><span class="o">)</span>
            <span class="o">.</span><span class="na">download</span><span class="o">(</span><span class="k">new</span> <span class="n">DownloadConfigBuilder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">defaultsForCommand</span><span class="o">(</span><span class="n">command</span><span class="o">)</span>
                <span class="o">.</span><span class="na">artifactStorePath</span><span class="o">(</span><span class="n">artifactStorePath</span><span class="o">))</span>
            <span class="o">.</span><span class="na">executableNaming</span><span class="o">(</span><span class="n">executableNaming</span><span class="o">))</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>

    <span class="n">MongodStarter</span> <span class="n">runtime</span> <span class="o">=</span> <span class="n">MongodStarter</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">runtimeConfig</span><span class="o">);</span>
    <span class="n">MongodExecutable</span> <span class="n">mongodExe</span> <span class="o">=</span> <span class="n">runtime</span><span class="o">.</span><span class="na">prepare</span><span class="o">(</span><span class="n">mongodConfig</span><span class="o">);</span>
    <span class="o">...</span>
</pre></div>

<h3>
<a name="usage---custom-mongod-process-output" class="anchor" href="#usage---custom-mongod-process-output"><span class="octicon octicon-link"></span></a>Usage - custom mongod process output</h3>

<h4>
<a name="-to-console-with-line-prefix" class="anchor" href="#-to-console-with-line-prefix"><span class="octicon octicon-link"></span></a>... to console with line prefix</h4>

<div class="highlight highlight-java"><pre>    <span class="o">...</span>
    <span class="n">ProcessOutput</span> <span class="n">processOutput</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProcessOutput</span><span class="o">(</span><span class="n">Processors</span><span class="o">.</span><span class="na">namedConsole</span><span class="o">(</span><span class="s">"[mongod&gt;]"</span><span class="o">),</span>
            <span class="n">Processors</span><span class="o">.</span><span class="na">namedConsole</span><span class="o">(</span><span class="s">"[MONGOD&gt;]"</span><span class="o">),</span> <span class="n">Processors</span><span class="o">.</span><span class="na">namedConsole</span><span class="o">(</span><span class="s">"[console&gt;]"</span><span class="o">));</span>

    <span class="n">IRuntimeConfig</span> <span class="n">runtimeConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RuntimeConfigBuilder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">defaults</span><span class="o">(</span><span class="n">Command</span><span class="o">.</span><span class="na">MongoD</span><span class="o">)</span>
        <span class="o">.</span><span class="na">processOutput</span><span class="o">(</span><span class="n">processOutput</span><span class="o">)</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>

    <span class="n">MongodStarter</span> <span class="n">runtime</span> <span class="o">=</span> <span class="n">MongodStarter</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">runtimeConfig</span><span class="o">);</span>
    <span class="o">...</span>
</pre></div>

<h4>
<a name="-to-file" class="anchor" href="#-to-file"><span class="octicon octicon-link"></span></a>... to file</h4>

<div class="highlight highlight-java"><pre>    <span class="o">...</span>
    <span class="n">IStreamProcessor</span> <span class="n">mongodOutput</span> <span class="o">=</span> <span class="n">Processors</span><span class="o">.</span><span class="na">named</span><span class="o">(</span><span class="s">"[mongod&gt;]"</span><span class="o">,</span>
            <span class="k">new</span> <span class="nf">FileStreamProcessor</span><span class="o">(</span><span class="n">File</span><span class="o">.</span><span class="na">createTempFile</span><span class="o">(</span><span class="s">"mongod"</span><span class="o">,</span> <span class="s">"log"</span><span class="o">)));</span>
    <span class="n">IStreamProcessor</span> <span class="n">mongodError</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileStreamProcessor</span><span class="o">(</span><span class="n">File</span><span class="o">.</span><span class="na">createTempFile</span><span class="o">(</span><span class="s">"mongod-error"</span><span class="o">,</span> <span class="s">"log"</span><span class="o">));</span>
    <span class="n">IStreamProcessor</span> <span class="n">commandsOutput</span> <span class="o">=</span> <span class="n">Processors</span><span class="o">.</span><span class="na">namedConsole</span><span class="o">(</span><span class="s">"[console&gt;]"</span><span class="o">);</span>

    <span class="n">IRuntimeConfig</span> <span class="n">runtimeConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RuntimeConfigBuilder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">defaults</span><span class="o">(</span><span class="n">Command</span><span class="o">.</span><span class="na">MongoD</span><span class="o">)</span>
        <span class="o">.</span><span class="na">processOutput</span><span class="o">(</span><span class="k">new</span> <span class="n">ProcessOutput</span><span class="o">(</span><span class="n">mongodOutput</span><span class="o">,</span> <span class="n">mongodError</span><span class="o">,</span> <span class="n">commandsOutput</span><span class="o">))</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>

    <span class="n">MongodStarter</span> <span class="n">runtime</span> <span class="o">=</span> <span class="n">MongodStarter</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">runtimeConfig</span><span class="o">);</span>
    <span class="o">...</span>

    <span class="o">...</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileStreamProcessor</span> <span class="kd">implements</span> <span class="n">IStreamProcessor</span> <span class="o">{</span>

        <span class="kd">private</span> <span class="n">FileOutputStream</span> <span class="n">outputStream</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">FileStreamProcessor</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">FileNotFoundException</span> <span class="o">{</span>
            <span class="n">outputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileOutputStream</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="n">String</span> <span class="n">block</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">outputStream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">block</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onProcessed</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">outputStream</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="o">...</span>
</pre></div>

<h4>
<a name="-to-java-logging" class="anchor" href="#-to-java-logging"><span class="octicon octicon-link"></span></a>... to java logging</h4>

<div class="highlight highlight-java"><pre>    <span class="o">...</span>
    <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>

    <span class="n">ProcessOutput</span> <span class="n">processOutput</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProcessOutput</span><span class="o">(</span><span class="n">Processors</span><span class="o">.</span><span class="na">logTo</span><span class="o">(</span><span class="n">logger</span><span class="o">,</span> <span class="n">Level</span><span class="o">.</span><span class="na">INFO</span><span class="o">),</span> <span class="n">Processors</span><span class="o">.</span><span class="na">logTo</span><span class="o">(</span><span class="n">logger</span><span class="o">,</span>
            <span class="n">Level</span><span class="o">.</span><span class="na">SEVERE</span><span class="o">),</span> <span class="n">Processors</span><span class="o">.</span><span class="na">named</span><span class="o">(</span><span class="s">"[console&gt;]"</span><span class="o">,</span> <span class="n">Processors</span><span class="o">.</span><span class="na">logTo</span><span class="o">(</span><span class="n">logger</span><span class="o">,</span> <span class="n">Level</span><span class="o">.</span><span class="na">FINE</span><span class="o">)));</span>

    <span class="n">IRuntimeConfig</span> <span class="n">runtimeConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RuntimeConfigBuilder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">defaultsWithLogger</span><span class="o">(</span><span class="n">Command</span><span class="o">.</span><span class="na">MongoD</span><span class="o">,</span><span class="n">logger</span><span class="o">)</span>
        <span class="o">.</span><span class="na">processOutput</span><span class="o">(</span><span class="n">processOutput</span><span class="o">)</span>
        <span class="o">.</span><span class="na">artifactStore</span><span class="o">(</span><span class="k">new</span> <span class="n">ArtifactStoreBuilder</span><span class="o">()</span>
            <span class="o">.</span><span class="na">defaults</span><span class="o">(</span><span class="n">Command</span><span class="o">.</span><span class="na">MongoD</span><span class="o">)</span>
            <span class="o">.</span><span class="na">download</span><span class="o">(</span><span class="k">new</span> <span class="n">DownloadConfigBuilder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">defaultsForCommand</span><span class="o">(</span><span class="n">Command</span><span class="o">.</span><span class="na">MongoD</span><span class="o">)</span>
                <span class="o">.</span><span class="na">progressListener</span><span class="o">(</span><span class="k">new</span> <span class="n">LoggingProgressListener</span><span class="o">(</span><span class="n">logger</span><span class="o">,</span> <span class="n">Level</span><span class="o">.</span><span class="na">FINE</span><span class="o">))))</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>

    <span class="n">MongodStarter</span> <span class="n">runtime</span> <span class="o">=</span> <span class="n">MongodStarter</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">runtimeConfig</span><span class="o">);</span>
    <span class="o">...</span>
</pre></div>

<h4>
<a name="-to-default-java-logging-the-easy-way" class="anchor" href="#-to-default-java-logging-the-easy-way"><span class="octicon octicon-link"></span></a>... to default java logging (the easy way)</h4>

<div class="highlight highlight-java"><pre>    <span class="o">...</span>
    <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>

    <span class="n">IRuntimeConfig</span> <span class="n">runtimeConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RuntimeConfigBuilder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">defaultsWithLogger</span><span class="o">(</span><span class="n">Command</span><span class="o">.</span><span class="na">MongoD</span><span class="o">,</span> <span class="n">logger</span><span class="o">)</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>

    <span class="n">MongodStarter</span> <span class="n">runtime</span> <span class="o">=</span> <span class="n">MongodStarter</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">runtimeConfig</span><span class="o">);</span>
    <span class="o">...</span>
</pre></div>

<h4>
<a name="-to-null-device" class="anchor" href="#-to-null-device"><span class="octicon octicon-link"></span></a>... to null device</h4>

<div class="highlight highlight-java"><pre>    <span class="o">...</span>
    <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>

    <span class="n">IRuntimeConfig</span> <span class="n">runtimeConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RuntimeConfigBuilder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">defaultsWithLogger</span><span class="o">(</span><span class="n">Command</span><span class="o">.</span><span class="na">MongoD</span><span class="o">,</span> <span class="n">logger</span><span class="o">)</span>
        <span class="o">.</span><span class="na">processOutput</span><span class="o">(</span><span class="n">ProcessOutput</span><span class="o">.</span><span class="na">getDefaultInstanceSilent</span><span class="o">())</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>

    <span class="n">MongodStarter</span> <span class="n">runtime</span> <span class="o">=</span> <span class="n">MongodStarter</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">runtimeConfig</span><span class="o">);</span>
    <span class="o">...</span>
</pre></div>

<h3>
<a name="custom-version" class="anchor" href="#custom-version"><span class="octicon octicon-link"></span></a>Custom Version</h3>

<div class="highlight highlight-java"><pre>    <span class="o">...</span>
    <span class="kt">int</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">12345</span><span class="o">;</span>
    <span class="n">IMongodConfig</span> <span class="n">mongodConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MongodConfigBuilder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">version</span><span class="o">(</span><span class="n">Versions</span><span class="o">.</span><span class="na">withFeatures</span><span class="o">(</span><span class="k">new</span> <span class="n">GenericVersion</span><span class="o">(</span><span class="s">"2.0.7-rc1"</span><span class="o">),</span><span class="n">Feature</span><span class="o">.</span><span class="na">SYNC_DELAY</span><span class="o">))</span>
        <span class="o">.</span><span class="na">net</span><span class="o">(</span><span class="k">new</span> <span class="n">Net</span><span class="o">(</span><span class="n">port</span><span class="o">,</span> <span class="n">Network</span><span class="o">.</span><span class="na">localhostIsIPv6</span><span class="o">()))</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>

    <span class="n">MongodStarter</span> <span class="n">runtime</span> <span class="o">=</span> <span class="n">MongodStarter</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">();</span>
    <span class="n">MongodProcess</span> <span class="n">mongod</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="n">MongodExecutable</span> <span class="n">mongodExecutable</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">mongodExecutable</span> <span class="o">=</span> <span class="n">runtime</span><span class="o">.</span><span class="na">prepare</span><span class="o">(</span><span class="n">mongodConfig</span><span class="o">);</span>
        <span class="n">mongod</span> <span class="o">=</span> <span class="n">mongodExecutable</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

        <span class="o">...</span>

    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">mongod</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">mongod</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">mongodExecutable</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
            <span class="n">mongodExecutable</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="o">...</span>
</pre></div>

<h3>
<a name="main-versions" class="anchor" href="#main-versions"><span class="octicon octicon-link"></span></a>Main Versions</h3>

<div class="highlight highlight-java"><pre>    <span class="n">IVersion</span> <span class="n">version</span> <span class="o">=</span> <span class="n">Version</span><span class="o">.</span><span class="na">V2_2_5</span><span class="o">;</span>
    <span class="c1">// uses latest supported 2.2.x Version</span>
    <span class="n">version</span> <span class="o">=</span> <span class="n">Version</span><span class="o">.</span><span class="na">Main</span><span class="o">.</span><span class="na">V2_2</span><span class="o">;</span>
    <span class="c1">// uses latest supported production version</span>
    <span class="n">version</span> <span class="o">=</span> <span class="n">Version</span><span class="o">.</span><span class="na">Main</span><span class="o">.</span><span class="na">PRODUCTION</span><span class="o">;</span>
    <span class="c1">// uses latest supported development version</span>
    <span class="n">version</span> <span class="o">=</span> <span class="n">Version</span><span class="o">.</span><span class="na">Main</span><span class="o">.</span><span class="na">DEVELOPMENT</span><span class="o">;</span>
</pre></div>

<h3>
<a name="use-free-server-port" class="anchor" href="#use-free-server-port"><span class="octicon octicon-link"></span></a>Use Free Server Port</h3>

<pre><code>Warning: maybe not as stable, as expected.
</code></pre>

<h4>
<a name="-by-hand" class="anchor" href="#-by-hand"><span class="octicon octicon-link"></span></a>... by hand</h4>

<div class="highlight highlight-java"><pre>    <span class="o">...</span>
    <span class="kt">int</span> <span class="n">port</span> <span class="o">=</span> <span class="n">Network</span><span class="o">.</span><span class="na">getFreeServerPort</span><span class="o">();</span>
    <span class="o">...</span>
</pre></div>

<h4>
<a name="-automagic" class="anchor" href="#-automagic"><span class="octicon octicon-link"></span></a>... automagic</h4>

<div class="highlight highlight-java"><pre>    <span class="o">...</span>
    <span class="n">IMongodConfig</span> <span class="n">mongodConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MongodConfigBuilder</span><span class="o">().</span><span class="na">version</span><span class="o">(</span><span class="n">Version</span><span class="o">.</span><span class="na">Main</span><span class="o">.</span><span class="na">PRODUCTION</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

    <span class="n">MongodStarter</span> <span class="n">runtime</span> <span class="o">=</span> <span class="n">MongodStarter</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">();</span>

    <span class="n">MongodExecutable</span> <span class="n">mongodExecutable</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="n">MongodProcess</span> <span class="n">mongod</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">mongodExecutable</span> <span class="o">=</span> <span class="n">runtime</span><span class="o">.</span><span class="na">prepare</span><span class="o">(</span><span class="n">mongodConfig</span><span class="o">);</span>
        <span class="n">mongod</span> <span class="o">=</span> <span class="n">mongodExecutable</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

        <span class="n">MongoClient</span> <span class="n">mongo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MongoClient</span><span class="o">(</span><span class="k">new</span> <span class="n">ServerAddress</span><span class="o">(</span><span class="n">mongodConfig</span><span class="o">.</span><span class="na">net</span><span class="o">().</span><span class="na">getServerAddress</span><span class="o">(),</span> <span class="n">mongodConfig</span><span class="o">.</span><span class="na">net</span><span class="o">().</span><span class="na">getPort</span><span class="o">()));</span>
        <span class="o">...</span>

    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">mongod</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">mongod</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">mongodExecutable</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
            <span class="n">mongodExecutable</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="o">...</span>
</pre></div>

<h3>
<a name="-custom-timeouts" class="anchor" href="#-custom-timeouts"><span class="octicon octicon-link"></span></a>... custom timeouts</h3>

<div class="highlight highlight-java"><pre>    <span class="o">...</span>
    <span class="n">IMongodConfig</span> <span class="n">mongodConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MongodConfigBuilder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">version</span><span class="o">(</span><span class="n">Version</span><span class="o">.</span><span class="na">Main</span><span class="o">.</span><span class="na">PRODUCTION</span><span class="o">)</span>
        <span class="o">.</span><span class="na">timeout</span><span class="o">(</span><span class="k">new</span> <span class="n">Timeout</span><span class="o">(</span><span class="mi">30000</span><span class="o">))</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">...</span>
</pre></div>

<h3>
<a name="command-line-post-processing" class="anchor" href="#command-line-post-processing"><span class="octicon octicon-link"></span></a>Command Line Post Processing</h3>

<div class="highlight highlight-java"><pre>    <span class="o">...</span>
    <span class="n">ICommandLinePostProcessor</span> <span class="n">postProcessor</span><span class="o">=</span> <span class="o">...</span>

    <span class="n">IRuntimeConfig</span> <span class="n">runtimeConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RuntimeConfigBuilder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">defaults</span><span class="o">(</span><span class="n">Command</span><span class="o">.</span><span class="na">MongoD</span><span class="o">)</span>
        <span class="o">.</span><span class="na">commandLinePostProcessor</span><span class="o">(</span><span class="n">postProcessor</span><span class="o">)</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">...</span>
</pre></div>

<h3>
<a name="custom-command-line-options" class="anchor" href="#custom-command-line-options"><span class="octicon octicon-link"></span></a>Custom Command Line Options</h3>

<p>We changed the syncDelay to 0 which turns off sync to disc. To turn on default value used defaultSyncDelay().</p>

<div class="highlight highlight-java"><pre>    <span class="n">IMongodConfig</span> <span class="n">mongodConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MongodConfigBuilder</span><span class="o">()</span>
    <span class="o">.</span><span class="na">version</span><span class="o">(</span><span class="n">Version</span><span class="o">.</span><span class="na">Main</span><span class="o">.</span><span class="na">PRODUCTION</span><span class="o">)</span>
    <span class="o">.</span><span class="na">cmdOptions</span><span class="o">(</span><span class="k">new</span> <span class="n">MongoCmdOptionsBuilder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">syncDeplay</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
        <span class="o">.</span><span class="na">useNoPrealloc</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
        <span class="o">.</span><span class="na">useSmallFiles</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
        <span class="o">.</span><span class="na">useNoJournal</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
        <span class="o">.</span><span class="na">build</span><span class="o">())</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">...</span>
</pre></div>

<h3>
<a name="snapshot-database-files-from-temp-dir" class="anchor" href="#snapshot-database-files-from-temp-dir"><span class="octicon octicon-link"></span></a>Snapshot database files from temp dir</h3>

<p>We changed the syncDelay to 0 which turns off sync to disc. To get the files to create an snapshot you must turn on default value (use defaultSyncDelay()).</p>

<div class="highlight highlight-java"><pre>    <span class="n">IMongodConfig</span> <span class="n">mongodConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MongodConfigBuilder</span><span class="o">()</span>
    <span class="o">.</span><span class="na">version</span><span class="o">(</span><span class="n">Version</span><span class="o">.</span><span class="na">Main</span><span class="o">.</span><span class="na">PRODUCTION</span><span class="o">)</span>
    <span class="o">.</span><span class="na">processListener</span><span class="o">(</span><span class="k">new</span> <span class="n">ProcessListenerBuilder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">copyDbFilesBeforeStopInto</span><span class="o">(</span><span class="n">destination</span><span class="o">)</span>
        <span class="o">.</span><span class="na">build</span><span class="o">())</span>
    <span class="o">.</span><span class="na">cmdOptions</span><span class="o">(</span><span class="k">new</span> <span class="n">MongoCmdOptionsBuilder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">defaultSyncDelay</span><span class="o">()</span>
        <span class="o">.</span><span class="na">build</span><span class="o">())</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">...</span>
</pre></div>

<h3>
<a name="start-mongos-with-mongod-instance" class="anchor" href="#start-mongos-with-mongod-instance"><span class="octicon octicon-link"></span></a>Start mongos with mongod instance</h3>

<p>this is an very easy example to use mongos and mongod</p>

<div class="highlight highlight-java"><pre>    <span class="kt">int</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">12121</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">defaultConfigPort</span> <span class="o">=</span> <span class="mi">12345</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">defaultHost</span> <span class="o">=</span> <span class="s">"localhost"</span><span class="o">;</span>

    <span class="n">MongodProcess</span> <span class="n">mongod</span> <span class="o">=</span> <span class="n">startMongod</span><span class="o">(</span><span class="n">defaultConfigPort</span><span class="o">);</span>

    <span class="k">try</span> <span class="o">{</span>
        <span class="n">MongosProcess</span> <span class="n">mongos</span> <span class="o">=</span> <span class="n">startMongos</span><span class="o">(</span><span class="n">port</span><span class="o">,</span> <span class="n">defaultConfigPort</span><span class="o">,</span> <span class="n">defaultHost</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">MongoClient</span> <span class="n">mongoClient</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MongoClient</span><span class="o">(</span><span class="n">defaultHost</span><span class="o">,</span> <span class="n">defaultConfigPort</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"DB Names: "</span> <span class="o">+</span> <span class="n">mongoClient</span><span class="o">.</span><span class="na">getDatabaseNames</span><span class="o">());</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">mongos</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
        <span class="n">mongod</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">MongosProcess</span> <span class="nf">startMongos</span><span class="o">(</span><span class="kt">int</span> <span class="n">port</span><span class="o">,</span> <span class="kt">int</span> <span class="n">defaultConfigPort</span><span class="o">,</span> <span class="n">String</span> <span class="n">defaultHost</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">UnknownHostException</span><span class="o">,</span>
            <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">IMongosConfig</span> <span class="n">mongosConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MongosConfigBuilder</span><span class="o">()</span>
            <span class="o">.</span><span class="na">version</span><span class="o">(</span><span class="n">Version</span><span class="o">.</span><span class="na">Main</span><span class="o">.</span><span class="na">PRODUCTION</span><span class="o">)</span>
            <span class="o">.</span><span class="na">net</span><span class="o">(</span><span class="k">new</span> <span class="n">Net</span><span class="o">(</span><span class="n">port</span><span class="o">,</span> <span class="n">Network</span><span class="o">.</span><span class="na">localhostIsIPv6</span><span class="o">()))</span>
            <span class="o">.</span><span class="na">configDB</span><span class="o">(</span><span class="n">defaultHost</span> <span class="o">+</span> <span class="s">":"</span> <span class="o">+</span> <span class="n">defaultConfigPort</span><span class="o">)</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>

        <span class="n">MongosExecutable</span> <span class="n">mongosExecutable</span> <span class="o">=</span> <span class="n">MongosStarter</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">().</span><span class="na">prepare</span><span class="o">(</span><span class="n">mongosConfig</span><span class="o">);</span>
        <span class="n">MongosProcess</span> <span class="n">mongos</span> <span class="o">=</span> <span class="n">mongosExecutable</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">mongos</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">MongodProcess</span> <span class="nf">startMongod</span><span class="o">(</span><span class="kt">int</span> <span class="n">defaultConfigPort</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">UnknownHostException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">IMongodConfig</span> <span class="n">mongoConfigConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MongodConfigBuilder</span><span class="o">()</span>
            <span class="o">.</span><span class="na">version</span><span class="o">(</span><span class="n">Version</span><span class="o">.</span><span class="na">Main</span><span class="o">.</span><span class="na">PRODUCTION</span><span class="o">)</span>
            <span class="o">.</span><span class="na">net</span><span class="o">(</span><span class="k">new</span> <span class="n">Net</span><span class="o">(</span><span class="n">defaultConfigPort</span><span class="o">,</span> <span class="n">Network</span><span class="o">.</span><span class="na">localhostIsIPv6</span><span class="o">()))</span>
            <span class="o">.</span><span class="na">configServer</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>

        <span class="n">MongodExecutable</span> <span class="n">mongodExecutable</span> <span class="o">=</span> <span class="n">MongodStarter</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">().</span><span class="na">prepare</span><span class="o">(</span><span class="n">mongoConfigConfig</span><span class="o">);</span>
        <span class="n">MongodProcess</span> <span class="n">mongod</span> <span class="o">=</span> <span class="n">mongodExecutable</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">mongod</span><span class="o">;</span>
    <span class="o">}</span>
</pre></div>

<h3>
<a name="import-json-file-with-mongoimport-command" class="anchor" href="#import-json-file-with-mongoimport-command"><span class="octicon octicon-link"></span></a>Import JSON file with mongoimport command</h3>

<div class="highlight highlight-java"><pre>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testStartAndStopMongoImportAndMongod</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">UnknownHostException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">defaultConfigPort</span> <span class="o">=</span> <span class="mi">12345</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">defaultHost</span> <span class="o">=</span> <span class="s">"localhost"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">database</span> <span class="o">=</span> <span class="s">"importTestDB"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">collection</span> <span class="o">=</span> <span class="s">"importedCollection"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">jsonFile</span><span class="o">=</span><span class="n">filePathAsString</span><span class="o">;</span>
        <span class="n">MongodProcess</span> <span class="n">mongod</span> <span class="o">=</span> <span class="n">startMongod</span><span class="o">(</span><span class="n">defaultConfigPort</span><span class="o">);</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="n">MongoImportProcess</span> <span class="n">mongoImport</span> <span class="o">=</span> <span class="n">startMongoImport</span><span class="o">(</span><span class="n">defaultConfigPort</span><span class="o">,</span> <span class="n">database</span><span class="o">,</span><span class="n">collection</span><span class="o">,</span><span class="n">jsonFile</span><span class="o">,</span><span class="kc">true</span><span class="o">,</span><span class="kc">true</span><span class="o">,</span><span class="kc">true</span><span class="o">);</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">MongoClient</span> <span class="n">mongoClient</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MongoClient</span><span class="o">(</span><span class="n">defaultHost</span><span class="o">,</span> <span class="n">defaultConfigPort</span><span class="o">);</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"DB Names: "</span> <span class="o">+</span> <span class="n">mongoClient</span><span class="o">.</span><span class="na">getDatabaseNames</span><span class="o">());</span>
            <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
                <span class="n">mongoImport</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">mongod</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">MongoImportProcess</span> <span class="nf">startMongoImport</span><span class="o">(</span><span class="kt">int</span> <span class="n">port</span><span class="o">,</span> <span class="n">String</span> <span class="n">dbName</span><span class="o">,</span> <span class="n">String</span> <span class="n">collection</span><span class="o">,</span> <span class="n">String</span> <span class="n">jsonFile</span><span class="o">,</span> <span class="n">Boolean</span> <span class="n">jsonArray</span><span class="o">,</span><span class="n">Boolean</span> <span class="n">upsert</span><span class="o">,</span> <span class="n">Boolean</span> <span class="n">drop</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">UnknownHostException</span><span class="o">,</span>
            <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">IMongoImportConfig</span> <span class="n">mongoImportConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MongoImportConfigBuilder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">version</span><span class="o">(</span><span class="n">Version</span><span class="o">.</span><span class="na">Main</span><span class="o">.</span><span class="na">PRODUCTION</span><span class="o">)</span>
                <span class="o">.</span><span class="na">net</span><span class="o">(</span><span class="k">new</span> <span class="n">Net</span><span class="o">(</span><span class="n">port</span><span class="o">,</span> <span class="n">Network</span><span class="o">.</span><span class="na">localhostIsIPv6</span><span class="o">()))</span>
                <span class="o">.</span><span class="na">db</span><span class="o">(</span><span class="n">dbName</span><span class="o">)</span>
                <span class="o">.</span><span class="na">collection</span><span class="o">(</span><span class="n">collection</span><span class="o">)</span>
                <span class="o">.</span><span class="na">upsert</span><span class="o">(</span><span class="n">upsert</span><span class="o">)</span>
                <span class="o">.</span><span class="na">dropCollection</span><span class="o">(</span><span class="n">drop</span><span class="o">)</span>
                <span class="o">.</span><span class="na">jsonArray</span><span class="o">(</span><span class="n">jsonArray</span><span class="o">)</span>
                <span class="o">.</span><span class="na">importFile</span><span class="o">(</span><span class="n">jsonFile</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>

        <span class="n">MongoImportExecutable</span> <span class="n">mongoImportExecutable</span> <span class="o">=</span> <span class="n">MongoImportStarter</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">().</span><span class="na">prepare</span><span class="o">(</span><span class="n">mongoImportConfig</span><span class="o">);</span>
        <span class="n">MongoImportProcess</span> <span class="n">mongoImport</span> <span class="o">=</span> <span class="n">mongoImportExecutable</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">mongoImport</span><span class="o">;</span>
    <span class="o">}</span>
</pre></div>

<h3>
<a name="executable-collision" class="anchor" href="#executable-collision"><span class="octicon octicon-link"></span></a>Executable Collision</h3>

<p>There is a good chance of filename collisions if you use a custom naming schema for the executable (see <a href="#usage---custom-mongod-filename">Usage - custom mongod filename</a>). If you got an exception, then you should make your RuntimeConfig or MongoStarter class or jvm static (static final in your test class or singleton class for all tests).</p>

<hr><p>YourKit is kindly supporting open source projects with its full-featured Java Profiler.
YourKit, LLC is the creator of innovative and intelligent tools for profiling
Java and .NET applications. Take a look at YourKit's leading software products:
<a href="http://www.yourkit.com/java/profiler/index.jsp">YourKit Java Profiler</a> and
<a href="http://www.yourkit.com/.net/profiler/index.jsp">YourKit .NET Profiler</a>.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Embedmongo.flapdoodle.de maintained by <a href="https://github.com/xorrr">xorrr</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
